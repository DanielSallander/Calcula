### The Bug: "Formula Bar Editing"
When I double-click a cell with existing content (e.g., "hello") to edit it in the formula bar:
**Expected:** The cell enters "Edit Mode" with the cursor at the end. If I type " world", the result should be "hello world".
**Actual:** The old content is cleared, and the cell only contains the new characters (e.g., " world").
It works when editing in the cell directly, but not when editing in the formula bar.
---

### Success Criteria

When double-clicking a cell with content "hello" and typing " world":
1. The InlineEditor should receive focus immediately
2. Keystrokes should go directly to the input (not through Container's "focus lost" path)
3. The formula bar should show "hello world" as I type
4. On Enter, the cell should commit "hello world"

### **What We Have Tried (Failed)**

1. **Focus Flags:** We tried using a global `preventBlurCommit` flag to stop the editor from committing when focus shifts, but the issue persists.
2. **Manual Double-Click:** We implemented manual double-click detection in `useMouseSelection` to ensure `startEditing` is called correctly. This works (Edit mode *does* start), but the subsequent typing still triggers the Replace logic.
3. **Append Mode Logic:** We tried adding logic to `useSpreadsheetEditing` to detect if editing is active and "append" the character instead of replacing. However, this seems to be fighting with the `InlineEditor`'s lifecycle (blur/commit events) causing recursion or empty commits.

### **Console messages**

Below are the messages from the console when first writing "hello" into a cell from the formular, then double clicking the cell to edit and append " world".

[InlineEditor] Focused input, cursor at position: 0
useEditing.ts:510 [useEditing] commitEdit called {editingRow: 0, editingCol: 0, sourceSheetIndex: 0, sourceSheetName: 'Sheet1', currentSheetIndex: 0, …}
tauri-api.ts:61 [tauri-api] updateCell(0, 0, "hello")
tauri-api.ts:64 [tauri-api] updateCell returned 1 updated cells
useViewport.ts:315 [VIEWPORT] scrollToSelection called: {endRow: 0, endCol: 0}
useViewport.ts:300 [VIEWPORT] scrollToCell called: {row: 0, col: 0, center: false}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION start: {
  "deltaRow": 1,
  "deltaCol": 0,
  "extend": false,
  "currentSelection": {
    "startRow": 0,
    "startCol": 0,
    "endRow": 0,
    "endCol": 0,
    "type": "cells"
  },
  "currentViewport": {
    "scrollX": 0,
    "scrollY": 0,
    "startRow": 0,
    "startCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION new selection: {
  "newSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  },
  "activeCell": {
    "activeRow": 1,
    "activeCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION expanded bounds: {
  "oldBounds": {
    "maxRow": 199,
    "maxCol": 51
  },
  "newBounds": {
    "maxRow": 199,
    "maxCol": 51
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION viewport dimensions: {
  "width": 1280,
  "height": 559
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION visibility check: {
  "isLargeJump": false,
  "cellCurrentlyVisible": true
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION scrollToMakeVisible result: {
  "scrollResult": null
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION no scroll needed: {
  "finalSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION start: {
  "deltaRow": 1,
  "deltaCol": 0,
  "extend": false,
  "currentSelection": {
    "startRow": 0,
    "startCol": 0,
    "endRow": 0,
    "endCol": 0,
    "type": "cells"
  },
  "currentViewport": {
    "scrollX": 0,
    "scrollY": 0,
    "startRow": 0,
    "startCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION new selection: {
  "newSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  },
  "activeCell": {
    "activeRow": 1,
    "activeCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION expanded bounds: {
  "oldBounds": {
    "maxRow": 199,
    "maxCol": 51
  },
  "newBounds": {
    "maxRow": 199,
    "maxCol": 51
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION viewport dimensions: {
  "width": 1280,
  "height": 559
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION visibility check: {
  "isLargeJump": false,
  "cellCurrentlyVisible": true
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION scrollToMakeVisible result: {
  "scrollResult": null
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION no scroll needed: {
  "finalSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  }
}
GridCanvas.tsx:277 [Cells] Fetched 1 cells. First cell: row=0, col=0, display="hello", style_index=0
InlineEditor.tsx:389 [InlineEditor] Focused input, cursor at position: 1
useEditing.ts:510 [useEditing] commitEdit called {editingRow: 0, editingCol: 0, sourceSheetIndex: 0, sourceSheetName: 'Sheet1', currentSheetIndex: 0, …}
tauri-api.ts:61 [tauri-api] updateCell(0, 0, " world")
tauri-api.ts:64 [tauri-api] updateCell returned 1 updated cells
useViewport.ts:315 [VIEWPORT] scrollToSelection called: {endRow: 0, endCol: 0}
useViewport.ts:300 [VIEWPORT] scrollToCell called: {row: 0, col: 0, center: false}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION start: {
  "deltaRow": 1,
  "deltaCol": 0,
  "extend": false,
  "currentSelection": {
    "startRow": 0,
    "startCol": 0,
    "endRow": 0,
    "endCol": 0,
    "type": "cells"
  },
  "currentViewport": {
    "scrollX": 0,
    "scrollY": 0,
    "startRow": 0,
    "startCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION new selection: {
  "newSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  },
  "activeCell": {
    "activeRow": 1,
    "activeCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION expanded bounds: {
  "oldBounds": {
    "maxRow": 199,
    "maxCol": 51
  },
  "newBounds": {
    "maxRow": 199,
    "maxCol": 51
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION viewport dimensions: {
  "width": 1280,
  "height": 559
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION visibility check: {
  "isLargeJump": false,
  "cellCurrentlyVisible": true
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION scrollToMakeVisible result: {
  "scrollResult": null
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION no scroll needed: {
  "finalSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION start: {
  "deltaRow": 1,
  "deltaCol": 0,
  "extend": false,
  "currentSelection": {
    "startRow": 0,
    "startCol": 0,
    "endRow": 0,
    "endCol": 0,
    "type": "cells"
  },
  "currentViewport": {
    "scrollX": 0,
    "scrollY": 0,
    "startRow": 0,
    "startCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION new selection: {
  "newSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  },
  "activeCell": {
    "activeRow": 1,
    "activeCol": 0
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION expanded bounds: {
  "oldBounds": {
    "maxRow": 199,
    "maxCol": 51
  },
  "newBounds": {
    "maxRow": 199,
    "maxCol": 51
  }
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION viewport dimensions: {
  "width": 1280,
  "height": 559
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION visibility check: {
  "isLargeJump": false,
  "cellCurrentlyVisible": true
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION scrollToMakeVisible result: {
  "scrollResult": null
}
gridReducer.ts:26 [VIEWPORT] MOVE_SELECTION no scroll needed: {
  "finalSelection": {
    "startRow": 1,
    "startCol": 0,
    "endRow": 1,
    "endCol": 0,
    "type": "cells"
  }
}
GridCanvas.tsx:277 [Cells] Fetched 1 cells. First cell: row=0, col=0, display="world", style_index=0