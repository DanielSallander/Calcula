# Project refactoring to adhere to architecture rules

While the backend (Rust) modularity is excellent and strictly separated, the Frontend (TypeScript) shows specific areas where **The Shell** and **The Core** are coupled, violating the Microkernel architecture.

### 1. The "Backend Brain" Violation (Rust)

**Rule:** *The Brain (Backend) is a minimal, stable engine that knows **nothing** about specific features.*
**Violation:** The dependency map shows a hardcoded `pivot` module inside the main application source.

* **Location:** `app/src-tauri/src/pivot/`
* **The Issue:** The "Brain" (`app/src-tauri/src`) explicitly contains a folder named `pivot`. This means the core calculation engine is aware of Pivot Tables. In a true Microkernel, "Pivot" should be a separate crate or a plugin loaded dynamically, or at least a separate module that implements a generic `Aggregator` trait defined by the Core.
* **Evidence:**
* `app/src-tauri/src/pivot/commands.rs` (Pivot-specific Tauri commands in the core binary)
* `app/src-tauri/src/pivot/engine.rs`

**Recommendation:** Move `app/src-tauri/src/pivot` into a separate crate (e.g., `crates/extension-pivot`) or a strictly isolated module that interacts with the Core only via a public `Calculation` trait.

### 2. The "Facade" Rule Violation (Frontend API)

**Rule:** *Extensions may **only** import from `app/src/api`. They must never import deep into `app/src/core/...`.*
**Violation:** The Pivot Extension appears to be performing canvas rendering, but the API layer does not expose the necessary rendering primitives.

* **Location:** `app/extensions/Pivot/rendering/pivot.ts`
* **The Issue:** This file contains `renderPivotView` (189 loc). To render on the HTML5 Canvas, it requires access to the `CanvasRenderingContext2D`, coordinate systems, and potentially `RenderState` or `Theme` objects.
* **The Gap:** Looking at `app/src/api/`, there are **no rendering interfaces exposed**:
* `app/src/api/grid.ts` (Logic only)
* `app/src/api/ui.ts` (DOM UI only, e.g., Dialogs/Menus)
* `app/src/api/gridOverlays.ts` (DOM overlays, not Canvas drawing)
